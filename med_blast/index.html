<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial de Instalação e Configuração do Docker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e0e0e0;
            color: #333;
            padding: 50px;
            text-align: left; /* Altera para alinhamento à esquerda */
        }

        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
            padding: 20px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            text-align: left; /* Altera para alinhamento à esquerda */
        }
        h1, h2, h3 {
            text-align: center;
            color: #333;
        }
        pre {
            background: #eee;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, "Courier New", monospace;
        }
        table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
            text-align: left;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #007BFF;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tutorial de Instalação <br> do Docker no Ubuntu 22.04</h1>
        <h3>Parte 1</h3>
        <ol>
            <li>
                Antes de mais nada, verifique se você já possui o Docker intalado. Caso tenha, passe para a parte 2 do Tutorial:
                <pre><code>docker version</code></pre>
            </li>
            <li>
                Certifique-se de que não existe nenhuma versão antiga instalada removendo-a:
                <pre><code>sudo apt-get remove docker docker-engine docker.io containerd runc</code></pre>
            </li>
            <li>
                Atualize o repositório:
                <pre><code>sudo apt-get update</code></pre>
            </li>
            <li>
                Instale pacotes necessários:
                <pre><code>sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common -y</code></pre>
            </li>
            <li>
                Adicione a chave oficial do Docker:
                <pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code></pre>
            </li>
            <li>
                Verifique se a chave foi adicionada:
                <pre><code>sudo apt-key fingerprint 0EBFCD88</code></pre>
            </li>
            <li>
                Adicione o repositório do Docker:
                <pre><code>sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"</code></pre>
            </li>
            <li>
                Instale o Docker:
                <pre><code>sudo apt-get install docker-ce docker-ce-cli containerd.io -y</code></pre>
            </li>
            <li>
                Verifique se o Docker foi corretamente instalado executando no terminal:
                <pre><code>docker version</code></pre>
            </li>
            <li>
                Adicione o seu usuário ao grupo do Docker:
                <pre><code>sudo usermod -aG docker $USER</code></pre>
                <p>--> REINICIE O TERMINAL</p>
            </li>
            <li>
                Teste a instalação executando o Hello World no terminal:
                <pre><code>docker run hello-world</code></pre>
            </li>
        </ol>
        
        <h2>Carregar e Executar o Med-Blast com Docker</h2>
        <h3>Parte 2</h3>
        <ol>
            <li>
                Configure o arquivo <code>.env</code> com suas informações:
                <pre><code>
POSTGRES_USER=postgres_user
POSTGRES_PASSWORD=password_key
POSTGRES_DB=api_med_blast
JWT_SECRET=secret_key
POSTGRES_HOST=db
                </code></pre>
            </li>
            <li>
                Carregue a imagem do Med-Blast:
                <pre><code>docker load -i med_blast_v0.5.tar</code></pre>
            </li>
            <li>
                Carregue o banco de dados:
                <pre><code>docker load -i postgres_v16.2.tar</code></pre>
            </li>
            <li>
                Execute o sistema:
                <pre><code>docker-compose -f med_blast.yml up -d</code></pre>
            </li>
            <li>
                Verifique se os containers estão em execução:
                <pre><code>docker ps</code></pre>
            </li>
            <li>
                Verifique no seu navegador, você deve ser capaz de acessar a documentação Swagger:
                <pre><code>http://127.0.0.1:8080/docs</code></pre>
            </li>
            <li>
                Crie as tabelas no banco de dados:
                <pre><code>docker exec -it med_blast python reset_sistema.py</code></pre>
            </li>
            <li>
                Crie o primeiro usuário. Você pode utilizar cURL ou qualquer outra forma de POST:
                <pre><code>
curl  -X POST \
  'http://127.0.0.1:8080/api/v1/usuarios/signup' \
  --header 'Accept: */*' \
  --header 'User-Agent: Thunder Client (https://www.thunderclient.com)' \
  --header 'Content-Type: application/json' \
  --data-raw '{
  "nome":"Nome Usuario",
  "email":"email@xxx.com",
  "senha":"sua_senha",
  "admin": true
}'
                </code></pre>
            </li>
            <li>
                Enviando um arquivo para processar em lote:
                <ol>
                    <li>Copie o arquivo para o docker (altere o path do seu arquivo):
                        <pre><code>docker cp /path-to-file/dataset_simulated_einstein_207k.tsv med_blast:/tmp</code></pre>
                    </li>
                    <li>Execute a partir do docker:
                        <pre><code>docker exec -it med_blast python scripts/med_blast_batch.py -d /tmp/dataset_simulated_einstein_207k.tsv -batch 10000 -token seu_token</code></pre>
                    </li>
                </ol>
            </li>
            <li>
                Logs gerados durante o processamento em lote:
                <ul>
                    <li><code>filename_error.log</code></li>
                    <li><code>filename_success.log</code></li>
                </ul>
            </li>
            <li>
                Para ver os logs, execute:
                <pre><code>
docker exec -it med_blast cat /tmp/dataset_simulated_einstein_207k_error.log
docker exec -it med_blast cat /tmp/dataset_simulated_einstein_207k_success.log
                </code></pre>
            </li>
            <li>
                Comandos gerais de gerenciamento:
                <pre><code>
docker ps
docker logs med_blast
docker restart med_blast
                </code></pre>
            </li>
        </ol>
        <h2>Exemplo de Formato do Arquivo</h2>
        <table>
            <thead>
                <tr>
                    <th>id_trauma_vitima</th>
                    <th>name</th>
                    <th>date_birth</th>
                    <th>sex</th>
                    <th>mother</th>
                    <th>cpf</th>
                    <th>cns</th>
                    <th>origem</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>cfb48c26-9930-11ee-9b7d-c4d0e3f817c2</td>
                    <td>Welington Pereira da Costa</td>
                    <td>1985-06-24</td>
                    <td>1</td>
                    <td>Fabiola Souza Pereira</td>
                    <td>90643385070</td>
                    <td></td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>d2e69146-9930-11ee-b924-c4d0e3f817c2</td>
                    <td>Edinaldo Almeida Quaresma</td>
                    <td>1914-07-20</td>
                    <td>1</td>
                    <td>Daiana Rocha Almeida</td>
                    <td></td>
                    <td>199238096880008</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>d26813ca-9930-11ee-9aaa-c4d0e3f817c2</td>
                    <td>Claudiane Peixoto Monteiro</td>
                    <td>1923-03-20</td>
                    <td>0</td>
                    <td>Luzia Peixoto Peixoto</td>
                    <td></td>
                    <td></td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>d2f21b9c-9930-11ee-b924-c4d0e3f817c2</td>
                    <td>Aguinaldo Camilo</td>
                    <td>1940-03-22</td>
                    <td>1</td>
                    <td>Helena Córdoba Camilo</td>
                    <td></td>
                    <td>207641956210002</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>cf22b4a4-9930-11ee-9b7d-c4d0e3f817c2</td>
                    <td>Jurema Castro da Mota Ribeiro</td>
                    <td>2005-06-01</td>
                    <td>0</td>
                    <td>Vera Ribeiro Córdoba da Mota</td>
                    <td>92363737202</td>
                    <td></td>
                    <td>3</td>
                </tr>
            </tbody>
        </table>
        
        <h2>FAQ</h2>
        <p>O sistema está usando alguma porta do banco com processo zumbi? Use os comandos abaixo para identificar o processo zumbi e usar <code>kill</code> para finalizar:</p>
        <ol>
            <li>Identificar o processo zumbi:
                <pre><code>
sudo ss -tulpn | grep 5433
# ou
sudo netstat -tulpn | grep 5433
                </code></pre>
            </li>
            <li>Matar o processo:
                <pre><code>sudo kill &lt;PID&gt;</code></pre>
            </li>
        </ol>
    </div>
</body>
</html>
